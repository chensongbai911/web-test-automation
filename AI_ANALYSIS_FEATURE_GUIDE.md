# AI 智能分析功能使用说明

## 功能概述

"让 AI 智能分析"按钮现在支持自动分析页面功能并生成测试意图，使用户可以更轻松地启动智能化测试。

## 使用流程

### 方式 1：自动分析模式（推荐）

1. **填写目标网址**

   - 在"目标网址"输入框中输入要测试的网站 URL
   - 例如：`https://example.com/account-management`

2. **不填写测试意图，直接点击"让 AI 智能分析"按钮**

   - 系统会自动：
     - 打开目标网页
     - 分析页面的所有交互元素（表单、按钮、链接、表格等）
     - 生成一份智能化的测试建议
     - 自动填入"告诉 AI 你想测试什么"文本框

3. **查看生成的建议（红色框区域）**

   - 系统会自动生成更全面的建议示例：
     ```
     测试3个表单（必填5项，含校验与提交），验证15个按钮交互与弹框处理，测试8个链接的同域跳转与导航，检查2个表格的分页/排序/搜索与数据渲染，覆盖选择器/日期/级联/复选/单选/开关、标签页/折叠面板，验证图表渲染与画布存在，处理1个iframe嵌入内容，校验登录/注册流程与错误提示，测试文件上传与大小/类型校验，校验页面导航与接口响应、可访问性（alt/label/ARIA）
     ```

4. **修改或确认建议**

   - 您可以修改生成的文本来定制测试内容
   - 也可以直接使用系统生成的建议

5. **再次点击"让 AI 智能分析"按钮启动测试**
   - 现在文本框有内容了，系统会开始实际的测试
   - 按钮会显示"⏳ 正在分析中..."的加载状态

### 方式 2：手动输入模式

1. **填写目标网址和测试意图**

   - 在"目标网址"输入框中输入 URL
   - 在"告诉 AI 你想测试什么"中手动填写您的测试需求
   - 例如：`测试登录流程、购物车功能、支付结算等`

2. **点击"让 AI 智能分析"按钮**
   - 系统会直接启动智能测试
   - 不会再进行页面分析

## 功能特性

✅ **智能页面分析（增强版）**

- 表单详情：字段类型/必填/校验规则/提交按钮
- 交互元素：按钮/链接/表格（分页/排序/搜索）
- 组件覆盖：选择器/日期/级联/复选/单选/开关/标签页/折叠
- 可访问性：ARIA/图片 alt/label 关联缺失统计
- 媒体与嵌入：图表渲染（Chart.js）与 iframe 概览
- 框架特征：React/Vue/Angular 识别，SPA 迹象
- 元信息与摘要：标题、关键词、描述、页面文本片段

✅ **智能建议生成**

- 基于结构化特征生成高质量测试意图摘要
- 覆盖表单/交互/组件/导航/可访问性/图表/iframe/认证/上传
- 页面元素较少时，提供通用但清晰的测试建议

✅ **用户友好**

- 生成建议后自动聚焦文本框并滚动到位置
- 用户可以修改建议内容来定制测试
- 清晰的日志提示指导整个过程

✅ **按钮状态管理**

- 分析过程中："让 AI 智能分析" → "⏳ 正在分析中..."
- 生成建议后：回到"🎯 让 AI 智能分析"
- 测试进行中："🎯 让 AI 智能分析" → "⏳ 正在分析中..."
- 测试完成后：恢复"🎯 让 AI 智能分析"

## 工作流程图

```
┌─ 输入URL ─┐
│           │
├─ 点击按钮 ┤
│           │
├─ 判断测试意图 ─┐
│               │
│  无意图         有意图
│  ↓             ↓
│  分析页面       直接开始测试
│  ↓
│  生成建议
│  ↓
│  填入文本框
│  ↓
│  用户可修改
│  ↓
│  再次点击按钮
│  ↓
│  开始测试
```

## 日志说明

系统会在日志区域显示以下信息：

| 消息                              | 含义                 |
| --------------------------------- | -------------------- |
| 🔍 正在分析页面功能...            | 页面分析已启动       |
| ✓ AI 已自动分析页面并生成测试建议 | 分析完成，建议已生成 |
| 🤖 正在理解测试意图并生成计划...  | 开始生成测试计划     |
| ⏳ 正在生成用例中...              | 生成测试用例过程中   |
| ✅ 测试已完成                     | 测试完成             |

## 常见问题

**Q: 如果页面分析失败怎么办？**
A: 系统会显示"⚠️ 页面分析失败"的提示，您可以手动填写测试意图后继续。

**Q: 生成的建议不准确怎么办？**
A: 您可以在文本框中编辑建议内容，定制您的测试需求。

**Q: 一个页面可以进行多次测试吗？**
A: 可以。测试完成后，您可以修改测试意图或保持原意图，再次点击按钮进行测试。

## 技术实现

- **前端**：`src/popup.js` 处理用户交互和按钮状态管理
- **页面分析**：`src/content-script.js` 执行增强版结构化分析
- **数据流**：通过 `chrome.tabs.sendMessage` 实现通信
- **建议生成**：内容脚本内生成 `intentSuggestion`，并在弹窗内兜底构建
