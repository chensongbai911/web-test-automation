# ğŸ”§ æµ‹è¯•æµç¨‹æ•…éšœæ’æŸ¥æŒ‡å— v1.8.2

**é—®é¢˜**: ç‚¹å‡»"å¼€å§‹æµ‹è¯•"åæ²¡æœ‰ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šï¼ˆæŠ¥å‘Šé¡µé¢ä¸ºç©ºï¼‰
**åŸå› åˆ†æ**: æµ‹è¯•æµç¨‹ä¸­ `analyzePageStructure` å’Œ `generateTestPlan` ä¸¤ä¸ªæ­¥éª¤çš„æ¶ˆæ¯å¤„ç†å™¨ç¼ºå¤±
**è§£å†³æ–¹æ¡ˆ**: âœ… å·²ä¿®å¤å¹¶æ·»åŠ äº†è¯Šæ–­å·¥å…·

---

## ğŸ¯ é—®é¢˜è¯Šæ–­æµç¨‹

### ç¬¬1æ­¥ï¼šé‡æ–°åŠ è½½æ‰©å±•ç¨‹åº
```
1. æ‰“å¼€ chrome://extensions/
2. æ‰¾åˆ° "WebåŠŸèƒ½è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·"
3. ç‚¹å‡»å³ä¸‹è§’çš„åˆ·æ–°æŒ‰é’® ğŸ”„
4. ç­‰å¾…æ‰©å±•ç¨‹åºé‡æ–°åŠ è½½å®Œæˆ
```

### ç¬¬2æ­¥ï¼šè¿è¡Œè¯Šæ–­å·¥å…·
åœ¨æŠ¥å‘Šé¡µé¢æˆ–ä»»ä½•ç½‘é¡µçš„æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œï¼š

```javascript
// åœ¨å¼¹å‡ºçš„ Popup çª—å£ä¸­ç‚¹å‡»"å¼€å§‹æµ‹è¯•"å
// å¿«é€Ÿæ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
// åœ¨æ§åˆ¶å°è¿è¡Œ:

testDiagnostics.runAll()
```

è¿™ä¼šè¾“å‡ºå®Œæ•´çš„è¯Šæ–­æŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼š
- âœ… æ¶ˆæ¯ç›‘å¬å™¨æ˜¯å¦æ­£ç¡®å·¥ä½œ
- âœ… Storage ä¸­æ˜¯å¦æœ‰æµ‹è¯•æ•°æ®
- âœ… content-script æ˜¯å¦å·²åŠ è½½
- âœ… é¡µé¢æ˜¯å¦æœ‰å¯äº¤äº’å…ƒç´ 

### ç¬¬3æ­¥ï¼šæŸ¥çœ‹è¯Šæ–­ç»“æœ

æ ¹æ®è¯Šæ–­ç»“æœé‡‡å–ç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼š

#### å¦‚æœæ˜¾ç¤º "âŒ analyzePageStructure å¤±è´¥"
```
åŸå› : content-script ä¸­ç¼ºå°‘è¿™ä¸ªæ¶ˆæ¯å¤„ç†å™¨
è§£å†³: å·²åœ¨v1.8.2ä¸­ä¿®å¤ï¼Œé‡æ–°åŠ è½½æ‰©å±•å³å¯
```

#### å¦‚æœæ˜¾ç¤º "âŒ æœªæ‰¾åˆ° testData"
```
åŸå› : æµ‹è¯•å¯èƒ½æ²¡æœ‰æˆåŠŸå¯åŠ¨ï¼Œæˆ–å¯åŠ¨åçš„æ•°æ®æ²¡æœ‰ä¿å­˜
è§£å†³:
1. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
2. æŸ¥çœ‹ content-script çš„æ—¥å¿—
3. æ£€æŸ¥ç½‘é¡µæ˜¯å¦åŠ è½½å®Œå…¨
```

#### å¦‚æœæ˜¾ç¤º "âŒ content-script æœªåŠ è½½"
```
åŸå› : content-script æ²¡æœ‰è¢«æ­£ç¡®æ³¨å…¥åˆ°é¡µé¢ä¸­
è§£å†³:
1. ç¡®ä¿é¡µé¢ä¸æ˜¯ç‰¹æ®Šé¡µé¢ (chrome://, about:ç­‰)
2. é‡æ–°åŠ è½½é¡µé¢
3. é‡æ–°åŠ è½½æ‰©å±•ç¨‹åº
```

#### å¦‚æœæ˜¾ç¤º "âš ï¸ é¡µé¢ä¸Šæ²¡æœ‰æ‰¾åˆ°å¯äº¤äº’å…ƒç´ "
```
åŸå› : é¡µé¢å¯èƒ½æ²¡æœ‰åŠ è½½å®Œå…¨ï¼Œæˆ–è€…æ²¡æœ‰æŒ‰é’®/è¾“å…¥æ¡†ç­‰å¯äº¤äº’å…ƒç´ 
è§£å†³:
1. ç­‰å¾…é¡µé¢åŠ è½½å®Œå…¨ (ç­‰å¾…3-5ç§’)
2. é€‰æ‹©æœ‰æ›´å¤šäº¤äº’å…ƒç´ çš„é¡µé¢è¿›è¡Œæµ‹è¯•
3. å°è¯•å…¶ä»–ç½‘ç«™ (å¦‚ https://uejin.cn/creator/home)
```

---

## ğŸš€ å®Œæ•´çš„æµ‹è¯•æµç¨‹ (ä¿®å¤å)

### æµç¨‹å›¾
```
ç‚¹å‡»"å¼€å§‹æµ‹è¯•"
    â†“
popup.js å‘é€è¯·æ±‚
    â†“
ã€ç¬¬1æ­¥ã€‘analyzePageStructure
    - åˆ†æé¡µé¢ç»“æ„
    - æ£€æµ‹å¯äº¤äº’å…ƒç´ 
    â†“
ã€ç¬¬2æ­¥ã€‘generateTestPlan
    - ç”Ÿæˆæµ‹è¯•è®¡åˆ’
    - ç¡®å®šæµ‹è¯•æ­¥éª¤
    â†“
ã€ç¬¬3æ­¥ã€‘startTest
    - æ‰§è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
    - æ”¶é›†æµ‹è¯•æ•°æ®
    â†“
ã€ç¬¬4æ­¥ã€‘ä¿å­˜æŠ¥å‘Š
    - å°†æ•°æ®ä¿å­˜åˆ° Chrome Storage
    - lastTestReport ä¸­ä¿å­˜å®Œæ•´æ•°æ®
    â†“
æ‰“å¼€æŠ¥å‘Šé¡µé¢
    - è¯»å– Chrome Storage
    - æ¸²æŸ“å›¾è¡¨å’Œè¡¨æ ¼
```

---

## ğŸ“ ä¿®å¤å†…å®¹è¯´æ˜

### ä¿®å¤äº†ä»€ä¹ˆ
åœ¨ `src/content-script.js` çš„æ¶ˆæ¯ç›‘å¬å™¨ä¸­æ·»åŠ äº†ä¸¤ä¸ªç¼ºå¤±çš„å¤„ç†å™¨ï¼š

#### å¤„ç†å™¨ 1: `analyzePageStructure`
```javascript
action: 'analyzePageStructure'
åŠŸèƒ½:
  - è°ƒç”¨ getInteractiveElements() è·å–é¡µé¢ä¸­çš„æ‰€æœ‰å¯äº¤äº’å…ƒç´ 
  - æå–å…ƒç´ çš„ç±»å‹ã€æ–‡æœ¬ã€é€‰æ‹©å™¨ç­‰ä¿¡æ¯
  - è¿”å›åˆ†æç»“æœç»™ popup
å“åº”æ ¼å¼:
  {
    success: true,
    analysis: {
      pageTitle: 'é¡µé¢æ ‡é¢˜',
      pageUrl: 'é¡µé¢URL',
      elementCount: 39,
      elements: [...]
    },
    elementCount: 39
  }
```

#### å¤„ç†å™¨ 2: `generateTestPlan`
```javascript
action: 'generateTestPlan'
åŠŸèƒ½:
  - æ ¹æ®åˆ†æç»“æœç”Ÿæˆæµ‹è¯•è®¡åˆ’
  - ä¸ºæ¯ä¸ªå…ƒç´ ç”Ÿæˆå¯¹åº”çš„æµ‹è¯•æ­¥éª¤
  - è®¡ç®—é¢„è®¡æµ‹è¯•æ—¶é—´
å“åº”æ ¼å¼:
  {
    success: true,
    plan: {
      steps: [
        { stepId: 1, action: 'click', target: 'selector', description: 'æè¿°' },
        ...
      ]
    },
    stepCount: 39,
    estimatedDuration: 45
  }
```

---

## ğŸ” é€æ­¥è¯Šæ–­æŒ‡å—

### æ­¥éª¤ 1: æ£€æŸ¥é¡µé¢æ˜¯å¦å¯ä»¥æ­£å¸¸åŠ è½½

```javascript
// åœ¨ä»»ä½•ç½‘é¡µçš„æ§åˆ¶å°è¿è¡Œ
console.log('é¡µé¢å·²åŠ è½½');
console.log('URL:', window.location.href);
console.log('Title:', document.title);
```

### æ­¥éª¤ 2: æ£€æŸ¥ content-script æ˜¯å¦å·²åŠ è½½

```javascript
// å¦‚æœè¿™ä¸ªå‘½ä»¤æœ‰è¾“å‡ºï¼Œè¯´æ˜ content-script å·²åŠ è½½
if (window.floatingBallManager) {
  console.log('âœ… content-script å·²åŠ è½½');
} else {
  console.log('âŒ content-script æœªåŠ è½½');
}
```

### æ­¥éª¤ 3: æ‰‹åŠ¨è§¦å‘åˆ†æ

```javascript
// åœ¨ç½‘é¡µçš„æ§åˆ¶å°è¿è¡Œ
chrome.runtime.sendMessage({
  action: 'analyzePageStructure',
  config: {}
}, (response) => {
  console.log('åˆ†æç»“æœ:', response);
});
```

### æ­¥éª¤ 4: æ‰‹åŠ¨è§¦å‘æµ‹è¯•è®¡åˆ’ç”Ÿæˆ

```javascript
// åœ¨ç½‘é¡µçš„æ§åˆ¶å°è¿è¡Œ
chrome.runtime.sendMessage({
  action: 'generateTestPlan',
  analysis: { elements: [] },
  config: {}
}, (response) => {
  console.log('æµ‹è¯•è®¡åˆ’:', response);
});
```

### æ­¥éª¤ 5: æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«ä¿å­˜

```javascript
// åœ¨ä»»ä½•é¡µé¢çš„æ§åˆ¶å°è¿è¡Œ
chrome.storage.local.get(['testData', 'lastTestReport'], (result) => {
  console.log('testData:', result.testData);
  console.log('lastTestReport:', result.lastTestReport);
});
```

---

## ğŸ’¡ å¸¸è§é—®é¢˜è§£ç­”

### Q: ä¿®å¤åè¿˜æ˜¯æ²¡æœ‰ç”ŸæˆæŠ¥å‘Šï¼Ÿ
**A**:
1. ç¡®ä¿å·²ç»é‡æ–°åŠ è½½æ‰©å±•ç¨‹åº (chrome://extensions ä¸­åˆ·æ–°)
2. è¿è¡Œè¯Šæ–­å·¥å…· `testDiagnostics.runAll()`
3. æŸ¥çœ‹è¯Šæ–­ç»“æœï¼Œæ ¹æ®å¤±è´¥é¡¹ç›®è¿›è¡Œæ’æŸ¥
4. æ£€æŸ¥é¡µé¢æ˜¯å¦æœ‰è¶³å¤Ÿçš„å¯äº¤äº’å…ƒç´ 

### Q: å¦‚ä½•çŸ¥é“æ‰©å±•ç¨‹åºæ˜¯å¦æ­£ç¡®åŠ è½½ï¼Ÿ
**A**:
åœ¨ä»»ä½•ç½‘é¡µçš„æ§åˆ¶å°è¿è¡Œï¼š
```javascript
chrome.runtime.sendMessage({ action: 'ping' }, (resp) => {
  if (chrome.runtime.lastError) {
    console.log('âŒ æ‰©å±•æœªåŠ è½½');
  } else {
    console.log('âœ… æ‰©å±•å·²åŠ è½½', resp);
  }
});
```

### Q: ä¸ºä»€ä¹ˆæŸäº›ç½‘ç«™æ— æ³•æµ‹è¯•ï¼Ÿ
**A**: å¯èƒ½åŸå› ï¼š
1. ç½‘ç«™ä½¿ç”¨äº† CSP (å†…å®¹å®‰å…¨ç­–ç•¥) é˜»æ­¢è„šæœ¬æ³¨å…¥
2. ç½‘ç«™æ˜¯ç‰¹æ®Šé¡µé¢ (chrome://, about:ç­‰)
3. ç½‘ç«™åŠ è½½ä¸å®Œå…¨
4. ç½‘ç«™æ²¡æœ‰å¯äº¤äº’å…ƒç´ 

è§£å†³æ–¹æ¡ˆï¼š
- é€‰æ‹©å…¶ä»–ç½‘ç«™è¿›è¡Œæµ‹è¯•
- ç­‰å¾…ç½‘é¡µå®Œå…¨åŠ è½½åå†ç‚¹å‡»"å¼€å§‹æµ‹è¯•"
- æ£€æŸ¥é¡µé¢æ˜¯å¦æœ‰æŒ‰é’®ã€é“¾æ¥ã€è¡¨å•ç­‰å…ƒç´ 

### Q: å¦‚ä½•è·å–æ›´è¯¦ç»†çš„æ—¥å¿—ï¼Ÿ
**A**:
æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)ï¼ŒæŸ¥çœ‹ Console æ ‡ç­¾ï¼Œä¼šçœ‹åˆ° [Webæµ‹è¯•å·¥å…·] å¼€å¤´çš„æ—¥å¿—

---

## ğŸ“‹ éªŒè¯ä¿®å¤æ˜¯å¦æˆåŠŸ

### æ–¹æ³• 1: å¿«é€ŸéªŒè¯

```javascript
// åœ¨ä»»ä½•ç½‘é¡µçš„æ§åˆ¶å°è¿è¡Œ
testDiagnostics.runAll()

// å¦‚æœæ‰€æœ‰æ£€æŸ¥éƒ½æ˜¾ç¤º âœ…ï¼Œè¯´æ˜ä¿®å¤æˆåŠŸ
```

### æ–¹æ³• 2: å®Œæ•´éªŒè¯æµç¨‹

1. æ‰“å¼€ä¸€ä¸ªæœ‰è¶³å¤Ÿäº¤äº’å…ƒç´ çš„ç½‘é¡µ (æ¨è uejin.cn)
2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
3. ç‚¹å‡»æ‰©å±•çš„"å¼€å§‹æµ‹è¯•"æŒ‰é’®
4. ç­‰å¾…æµ‹è¯•å®Œæˆ (~2åˆ†é’Ÿ)
5. æ‰“å¼€æŠ¥å‘Šé¡µé¢ï¼ŒæŸ¥çœ‹æ˜¯å¦æ˜¾ç¤ºæ•°æ®
6. å¦‚æœå›¾è¡¨å’Œè¡¨æ ¼éƒ½æœ‰æ•°æ®ï¼Œè¯´æ˜ä¿®å¤æˆåŠŸ âœ…

---

## ğŸ”„ å¦‚æœä»ç„¶æœ‰é—®é¢˜

### æ¢å¤åˆ°ç¨³å®šç‰ˆæœ¬

å¦‚æœä¿®å¤åä»æœ‰é—®é¢˜ï¼Œå¯ä»¥æ¢å¤åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼š

1. æ‰“å¼€ `src/content-script.js`
2. æŸ¥æ‰¾ç¬¬ 213 è¡Œçš„ `chrome.runtime.onMessage.addListener`
3. æ£€æŸ¥æ˜¯å¦æœ‰ä»¥ä¸‹å¤„ç†å™¨ï¼š
   - `analyzePageStructure` âœ…
   - `generateTestPlan` âœ…
   - `startTest` âœ…

å¦‚æœç¼ºå¤±ä»»ä½•ä¸€ä¸ªï¼Œéœ€è¦é‡æ–°åº”ç”¨ä¿®å¤ã€‚

### å®Œæ•´æ—¥å¿—æ”¶é›†

```javascript
// åœ¨æ§åˆ¶å°è¿è¡Œè¿™ä¸ªå‘½ä»¤æ”¶é›†è¯Šæ–­æ•°æ®
const diagnosticReport = {
  timestamp: new Date().toISOString(),
  pageUrl: window.location.href,
  storageData: null,
  extensionStatus: null,
  pageElements: null
};

// è·å– Storage æ•°æ®
chrome.storage.local.get(['testData', 'lastTestReport'], (result) => {
  diagnosticReport.storageData = result;

  // è·å–æ‰©å±•çŠ¶æ€
  chrome.runtime.sendMessage({ action: 'ping' }, (resp) => {
    diagnosticReport.extensionStatus = resp;

    // è·å–é¡µé¢å…ƒç´ ä¿¡æ¯
    diagnosticReport.pageElements = {
      buttons: document.querySelectorAll('button').length,
      links: document.querySelectorAll('a[href]').length,
      inputs: document.querySelectorAll('input').length
    };

    // è¾“å‡ºå®Œæ•´æŠ¥å‘Š
    console.log('å®Œæ•´è¯Šæ–­æŠ¥å‘Š:', JSON.stringify(diagnosticReport, null, 2));
  });
});
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼š

1. æ”¶é›†å®Œæ•´çš„è¯Šæ–­æ•°æ® (è§ä¸Šé¢çš„æ—¥å¿—æ”¶é›†)
2. æŸ¥çœ‹æµè§ˆå™¨ Console ä¸­çš„æ‰€æœ‰é”™è¯¯ä¿¡æ¯
3. å°è¯•åœ¨ä¸åŒçš„ç½‘é¡µä¸Šæµ‹è¯•
4. æ£€æŸ¥æ‰©å±•æƒé™æ˜¯å¦æ­£ç¡®
5. å°è¯•å¸è½½å¹¶é‡æ–°å®‰è£…æ‰©å±•

---

## âœ… ä¿®å¤éªŒè¯æ¸…å•

- [x] æ·»åŠ  `analyzePageStructure` æ¶ˆæ¯å¤„ç†å™¨
- [x] æ·»åŠ  `generateTestPlan` æ¶ˆæ¯å¤„ç†å™¨
- [x] éªŒè¯æ¶ˆæ¯å“åº”æ ¼å¼æ­£ç¡®
- [x] åˆ›å»ºè¯Šæ–­è„šæœ¬ `test-flow-diagnostics.js`
- [x] ç¼–å†™å®Œæ•´çš„æ•…éšœæ’æŸ¥æ–‡æ¡£

**ç‰ˆæœ¬**: v1.8.2
**ä¿®å¤æ—¥æœŸ**: 2024-01-09
**çŠ¶æ€**: âœ… å·²ä¿®å¤ï¼Œè¯Šæ–­å·¥å…·å°±ç»ª
