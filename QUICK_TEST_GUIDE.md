## 🚀 快速测试指南

### ⚡ 一分钟快速开始

#### 1️⃣ 启动本地服务器（已运行）
```bash
python -m http.server 9999 --bind 127.0.0.1
```

#### 2️⃣ 打开扩展popup
- Chrome浏览器 → 点击扩展图标
- 打开"让AI智能分析"标签

#### 3️⃣ 输入测试URL
```
http://127.0.0.1:9999/test-workflow.html
```

#### 4️⃣ 开始工作流测试

**第一步**：点击"让AI智能分析" 🔍
```
等待屏幕中央显示蓝紫色加载框：
  🔍 正在分析意图
  [========░░░] 25%
```

**第二步**：观看进度变化
```
进度变化序列：
  25% → 正在分析页面...
  50% → 正在提取页面结构...
  100% → ✅ 意图生成完成（自动关闭）
```

**第三步**：意图自动填充到红色框
```
红色意图输入框自动填充：
"测试1个表单（必填3项，含校验与提交），
验证8个按钮交互与弹框处理，
测试6个链接的同域跳转与导航，
检查1个表格的分页/排序/搜索与数据渲染，..."
```

**第四步**：点击"开始AI测试" 🤖
```
显示新的加载框：
  🤖 正在生成测试计划
  [=========░] 30%
```

**第五步**：观看计划生成
```
进度变化序列：
  30% → AI正在理解意图...
  70% → 正在保存计划配置...
  90% → [下方显示AI计划信息]
```

**第六步**：点击执行测试 🚀
```
显示执行加载框：
  🚀 正在执行测试
  [=░░░░░░░░] 10%
  
实时更新测试统计：
  已测试：15项
  成功：12项
  失败：3项
```

---

### 📋 完整工作流映射

```
用户操作              加载提示              后台处理
─────────────────────────────────────────────────────
点击AI智能分析
                    显示 (25%)        → 分析页面结构
                    更新 (50%)        → 提取表单/按钮/链接等
                    完成 (100%)       → 生成intentSuggestion
                    隐藏 (500ms)      

自动填充意图
修改意图（可选）

点击开始AI测试
                    显示 (30%)        → 发送startIntelligentTest
                    更新 (70%)        → 保存计划配置
                    显示 (90%)        → 渲染AI计划
                    隐藏             

查看计划
点击执行测试
                    显示 (10%)        → 初始化执行器
执行测试进行中
                    更新 (10-90%)     → 遍历元素执行操作
                    同步统计          → 更新已测/成功/失败
测试完成
                    隐藏 (100%)       → 生成报告
```

---

### 🔍 验证检查清单

在popup控制台（F12）观察日志：

- [ ] **分析阶段**
  ```
  ✓ 🔍 正在分析页面功能...
  ✓ AI已自动分析页面并生成测试建议
  ```

- [ ] **计划阶段**
  ```
  ✓ 🤖 正在理解测试意图并生成计划...
  ✓ AI计划生成完成，即将按推荐配置启动测试
  ```

- [ ] **执行阶段**
  ```
  ✓ 🚀 [TestOrchestrator] 初始化自动化测试
  ✓ [AITestOrchestrator] 开始执行智能测试
  ✓ [测试完成] 共测试X项，成功Y项，失败Z项
  ```

---

### 🎯 高级测试场景

#### 测试场景1：完整表单流程
1. 输入URL并分析
2. 意图自动填充为：`"测试1个表单（必填3项..."`
3. 点击"开始AI测试"
4. 验证表单被逐个填充
5. 验证提交按钮被点击

#### 测试场景2：交互按钮测试
1. 观察意图包含：`"验证8个按钮交互与弹框处理"`
2. 点击执行
3. 验证每个按钮被点击
4. 验证对话框打开/关闭

#### 测试场景3：链接导航测试
1. 观察意图包含：`"测试6个链接的同域跳转"`
2. 执行测试
3. 验证链接被访问
4. 验证导航成功

#### 测试场景4：无障碍检测
1. 意图包含：`"可访问性（alt/label/ARIA）"`
2. 验证ARIA元素被正确识别（修复后）
3. 验证标签关联被检测
4. 验证alt文本被验证

---

### ⚠️ 常见问题排查

#### Q1：加载提示不显示？
```
检查：
☐ globalLoadingOverlay div 是否存在（popup.html第686行）
☐ showGlobalLoading() 函数是否被调用
☐ 浏览器console是否有JavaScript错误
☐ popup.js 是否正确加载（检查Sources标签）
```

#### Q2：意图没有自动填充？
```
检查：
☐ testIntentInput 元素是否存在（id="testIntentInput"）
☐ analyzePageForIntent 是否返回成功响应
☐ resp.intentSuggestion 是否有内容
☐ console 中是否有"页面分析失败"错误
```

#### Q3：ARIA选择器仍报错？
```
确保已应用修复：
content-script.js 第392-400行改为：
  ariaElements: Array.from(document.querySelectorAll('*')).filter(el => {
    return Array.from(el.attributes).some(attr => attr.name.startsWith('aria-'));
  }).length,
```

#### Q4：进度条不动？
```
检查：
☐ updateGlobalLoading() 是否被调用
☐ percent 值是否在0-100之间
☐ CSS是否支持 transition（现代浏览器都支持）
☐ 控制台是否有"Cannot read property"错误
```

---

### 📊 测试数据参考

**测试页面包含**：
```
✓ 1个表单 + 8个输入字段 + 必填校验
✓ 8个按钮（包括提交、重置、交互）
✓ 6个链接（内部+外部）
✓ 1个表格（4行数据 + 编辑操作）
✓ 2个下拉选择（含级联功能）
✓ 8个复选框 + 3个单选框
✓ 1个开关控件
✓ 3个标签页 + 内容切换
✓ 1个模态对话框
✓ 1个Canvas图表
✓ 1个iframe嵌入
✓ 搜索与过滤功能
✓ ARIA无障碍属性示例
```

**预期生成的意图**：
```
"测试1个表单（必填3项，含校验与提交），
验证8个按钮交互与弹框处理，
测试6个链接的同域跳转与导航，
检查1个表格的分页/排序/搜索与数据渲染，
覆盖选择器/日期/级联/复选/单选/开关、标签页/折叠面板，
验证图表渲染与画布存在，
处理1个iframe嵌入内容，
校验页面导航与接口响应、可访问性（alt/label/ARIA）"
```

---

### 🔨 开发者工具使用

#### 打开F12开发者工具
```
Chrome: F12 或 Ctrl+Shift+I
选择 Console 标签查看日志
```

#### 关键日志位置
```
[Popup] 日志
  └─ startIntelligentTestBtn click
  └─ showGlobalLoading() 调用
  └─ analyzePageForIntent 响应

[Content] 日志
  └─ analyzePageForIntent 执行
  └─ 各类型元素统计

[TestOrchestrator] 日志
  └─ startIntelligentTest 处理
  └─ 计划生成过程
```

#### 监控网络请求
```
F12 → Network 标签
观察：
  └─ chrome-extension:// 消息（内部通信）
  └─ HTTP请求（如有API调用）
  └─ 响应时间和大小
```

---

### 📝 记录测试结果

**测试通过标准**：
```
✅ 所有三阶段加载提示正确显示
✅ 进度条平滑动画效果
✅ 百分比数字正确更新
✅ 意图自动填充到输入框
✅ AI计划正确生成和显示
✅ 测试执行进度实时更新
✅ 所有加载提示在完成后自动隐藏
✅ 控制台无JavaScript错误
✅ 响应时间在合理范围（<5s）
```

**记录失败项**：
```
日期：
阶段：[分析/计划/执行]
问题描述：
期望行为：
实际行为：
控制台错误：
截图：
```

---

### 🎓 技术背景

**为什么修复ARIA选择器**：
- CSS规范不支持 `[attr*="value"]` 的通配符语法
- 需要遍历属性来动态检查前缀匹配
- 这样能检测所有 `aria-*` 属性（label, describedby, hidden, live等）

**三阶段加载的设计理由**：
- 第一阶段：用户感知分析工作（25%→100%）
- 第二阶段：AI理解和规划（30%→90%）
- 第三阶段：实际执行工作（10%→100%）
- 统一UI避免多个重叠提示框

**进度百分比的含义**：
- 不是精确的完成度，而是工作阶段的视觉表示
- 帮助用户理解当前在哪个步骤
- 提供持续的反馈防止用户认为应用卡住

---

**准备好开始测试了！** 🎉

从第二部分开始：输入URL并点击"让AI智能分析"按钮
