# 快速测试指南 - 验证三项修复

## 🚀 快速开始（5 分钟）

### 第 1 步：重新加载扩展

1. 打开 Chrome 浏览器
2. 在地址栏输入：`chrome://extensions/`
3. 找到"Web 功能自动化测试工具"
4. 点击右下角的"重载"按钮
5. 等待扩展加载完成

### 第 2 步：打开开发者工具

1. 在任何网站上，按 `F12` 打开 DevTools
2. 点击 "Console" 标签页
3. 在 Filters 中输入要搜索的内容（可选）

### 第 3 步：打开扩展 Popup

1. 点击浏览器右上角的扩展图标（如果看不到，点击扩展菜单）
2. 点击"Web 功能自动化测试工具"
3. Popup 窗口应该会打开

---

## ✅ 验证修复 #1：按钮状态正确

### 场景：点击"让 AI 智能分析"按钮

```
操作步骤：
1. 在 popup 中填写测试 URL（如：https://www.example.com）
2. 点击"让AI智能分析"按钮
3. 等待 30-60 秒

预期结果：
✅ "查看测试用例报告"按钮变成绿色 (#4CAF50)
✅ 按钮文本变为"📥 查看测试用例报告"
✅ 按钮可以点击（鼠标悬停时指针变成手形）

控制台日志迹象：
✅ [Popup] AI计划生成完成，即将按推荐配置启动测试
✅ [Popup] ✅ 测试用例报告按钮已更新为可查看状态
✅ [Popup] ⚠️ 测试用例报告按钮保持可用状态

不应该看到：
❌ [Popup] downloadTestCaseReportBtn.disabled = true
```

---

## ✅ 验证修复 #2：浮球正确显示

### 场景：浮球在测试执行时出现

```
操作步骤：
1. 继续上面的测试，或点击"立即开始测试"
2. 查看浏览器窗口（测试网站的页面）
3. 观察页面右下角 5 秒钟

预期结果：
✅ 右下角出现悬浮球（📊 图标 + 数字）
✅ 悬浮球上的数字随时间更新（0 → 1 → 2...）
✅ 点击悬浮球时展开进度面板
✅ 进度面板显示实时统计数据

控制台日志迹象：
✅ [FloatingBallInjector] 📢 发送 floatingBallReady 事件到 injector
✅ [FloatingBallInjector] 🎯 FloatingBall脚本已就绪
✅ [FloatingBall] ========== 🔥 showBall()开始执行 ==========
✅ [FloatingBall] ✅ 悬浮球已显示（display=block）

如果消息被缓存（这是正常的）：
ℹ️ [FloatingBallInjector] ⏳ FloatingBall未就绪，消息入队: showFloatingBall
ℹ️ [FloatingBallInjector] 📨 从队列发送缓存消息: showFloatingBall

不应该看到：
❌ [FloatingBall] ⚠️ 悬浮球容器不存在
❌ [FloatingBall] ❌ 悬浮球重新注入失败
```

---

## ✅ 验证修复 #3：测试进度更新

### 场景：测试进度实时更新（等待 20-30 秒）

```
观察点：

Popup 中的日志区域：
✅ 应该看到类似以下日志：
   • ✓ 测试已开始！
   • 📄 页面: https://...
   • 🔒 测试域名: example.com
   • 🚀 开始自动化测试流程...
   • 📝 检测页面中的表单...
   • ✓ 表单检测完成
   • 🔗 检测页面链接...
   • ⚙️ 已测试: X 项，成功: Y 项
   （日志应该持续更新，不应该卡顿）

状态区域：
✅ "已测试项目"数字应该逐渐增加
✅ "成功"、"失败"等统计应该更新
✅ 进度条应该逐渐填满

悬浮球：
✅ 球上的数字应该与"已测试项目"数字同步
✅ 进度面板中的各个卡片数字应该更新

不应该看到：
❌ 所有日志都停留在"正在生成测试用例中"
❌ 进度条和数字完全不变
❌ 控制台有大量错误信息
```

---

## 🔍 完整诊断（如果修复没有完全生效）

### 如果按钮仍然被禁用

```
1. 在浏览器控制台搜索：
   grep "downloadTestCaseReportBtn.disabled = true"

2. 应该只看到被注释掉的代码：
   ✅ // downloadTestCaseReportBtn.disabled = true; // 删除这一行

3. 如果看到未注释的代码，说明修复未生效，需要重新加载扩展
```

### 如果浮球不显示

```
1. 在浏览器控制台查找：
   "浮球容器不存在"

2. 如果看到此消息，说明 DOM 注入失败
   • 检查是否有 CSP 错误
   • 检查网站是否禁止脚本注入

3. 查找：
   "FloatingBall脚本已就绪"

4. 如果看不到此消息，脚本注入失败
   • 查看是否有加载错误
   • 检查 manifest.json web_accessible_resources
```

### 如果日志不更新

```
1. 检查 content-script 是否在执行：
   搜索 "startAutomatedTest被调用"

2. 检查消息是否转发到 popup：
   搜索 "Background forwarding addLog"

3. 如果 content-script 中有日志但 popup 中没有：
   • Popup 可能已关闭
   • Chrome 消息传递可能被阻止
   • 尝试保持 popup 打开状态
```

---

## 📊 快速参考表

| 项目         | 修复前           | 修复后             | 检验方式                   |
| ------------ | ---------------- | ------------------ | -------------------------- |
| **按钮状态** | AI 计划后被禁用  | AI 计划后启用+绿色 | 点击"让 AI 智能分析"后观察 |
| **浮球显示** | 不显示或随机显示 | 可靠显示           | 查看页面右下角             |
| **消息队列** | 消息可能丢失     | 所有消息缓存处理   | 查看 console 中的队列日志  |
| **测试进度** | 卡顿或无更新     | 连续更新           | 观察日志和数字是否变化     |

---

## 🛠️ 故障排除

### 问题：Popup 打开时崩溃

**解决方案**：

1. 清除浏览器缓存：`Ctrl+Shift+Delete`
2. 重新加载扩展
3. 在新标签页中打开网站后再开启 popup

### 问题：控制台出现"扩展上下文已失效"错误

**解决方案**：

1. 这通常发生在网站导航或刷新时
2. 重新加载扩展（`chrome://extensions/` 中的重载按钮）
3. 重新打开网站后测试

### 问题：浮球显示但不更新进度

**解决方案**：

1. 检查是否点击了"暂停"按钮
2. 检查网站是否有很多元素（可能导致测试变慢）
3. 查看 console 中是否有错误

### 问题：测试执行但消息不出现在 popup

**解决方案**：

1. 确保 popup 窗口没有被关闭
2. 尝试点击 popup 窗口使其获得焦点
3. 检查 popup 中是否有消息滚动条（可能需要向下滚动）

---

## 📝 测试报告模板

如果问题仍然存在，请提供以下信息：

```
【修复验证报告】

测试时间：[日期 时间]
测试网站：[URL]
浏览器版本：[Chrome 版本号]

【修复 #1 - 按钮状态】
- 点击"让AI智能分析"后，按钮是否变成绿色？ [ ] 是 [ ] 否
- "查看测试用例报告"按钮是否可点击？ [ ] 是 [ ] 否
- Console 中是否有 "按钮已更新为可查看状态"？ [ ] 是 [ ] 否

【修复 #2 - 浮球显示】
- 测试执行时，页面右下角是否出现悬浮球？ [ ] 是 [ ] 否
- 悬浮球上的数字是否实时更新？ [ ] 是 [ ] 否
- Console 中是否有 "showBall()开始执行"？ [ ] 是 [ ] 否

【修复 #3 - 测试进度】
- Popup 中的日志是否连续更新？ [ ] 是 [ ] 否
- "已测试项目"数字是否逐渐增加？ [ ] 是 [ ] 否
- 进度条是否填满？ [ ] 是 [ ] 否

【截图】
- 按钮状态截图（如果不同预期）
- 浮球显示截图（如果不显示）
- Console 错误截图（如果有错误）

【备注】
[任何其他观察或错误信息]
```

---

## 📞 获取更多帮助

如果上述所有步骤都无法解决问题：

1. **清除扩展数据**：

   - `chrome://extensions/` 中的"清除数据"按钮
   - 然后重新加载扩展

2. **检查网络连接**：

   - Qwen API 是否可访问
   - 代理或防火墙是否阻止请求

3. **查看完整日志**：
   - 在浏览器 DevTools 中保存所有 console 日志
   - 使用截图工具捕获完整的控制台输出

---

**修复版本**：2025-01-15
**预期生效时间**：重新加载后立即生效
**回退方法**：如需回退，使用 git 恢复或重新下载扩展
