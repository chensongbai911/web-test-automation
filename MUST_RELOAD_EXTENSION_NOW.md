# ⚠️ 扩展 Context 已失效 - 必须重新加载！

## 🔴 当前状态

从 Console 日志可以看到：

```
[ExtensionContextChecker] 定期检查发现context已失效
⚠️ 扩展上下文已失效，请重新加载扩展
```

**这意味着 Chrome 扩展的 runtime 已经断开，任何操作都无法执行！**

## 🎯 立即执行（必须完成）

### 第 1 步: 重新加载扩展 ⚡

1. **新开一个标签页**，在地址栏输入：

   ```
   chrome://extensions/
   ```

2. **找到扩展**："Web 功能自动化测试工具"

3. **点击重新加载按钮**：

   - 找到扩展卡片右下角的 🔄 图标
   - 或者点击扩展卡片上的"重新加载"按钮

4. **等待重新加载完成**（1-2 秒）

### 第 2 步: 关闭测试页面

1. **关闭当前这个页面**（192.168.8.158:30002）
2. 不要刷新，直接关闭标签页

### 第 3 步: 重新打开测试页面

1. 打开新标签页
2. 重新访问：`http://192.168.8.158:30002/account-authorization/entrust`

### 第 4 步: 验证扩展已恢复

打开 F12 Console，应该看到：

```
[Web测试工具] Content script已加载
[ExtensionContextChecker] 已初始化
[ExtensionContextChecker] 已启动定期检查，间隔: 5000 ms
[Web测试工具] ✅ AI测试编排器已初始化
```

如果看到这些日志，说明扩展已经恢复正常！

### 第 5 步: 重新测试

1. 点击浏览器工具栏的扩展图标
2. 输入 URL（或使用当前页面）
3. 填写/不填写测试意图
4. 点击"让 AI 智能分析"
5. **现在应该正常工作了！**

---

## ❓ 为什么会失效？

Chrome 扩展的 context 在以下情况会失效：

1. **开发时修改代码** - Chrome 自动重新加载扩展
2. **手动点击重新加载** - 在扩展管理页操作
3. **浏览器更新** - Chrome 更新后重启
4. **扩展更新** - 扩展自动更新

**一旦失效，所有功能都会停止工作，必须重新加载！**

---

## 🎨 页面提示

如果扩展正常工作，当检测到 context 失效时，页面右上角应该会显示一个紫色的提示框：

```
┌──────────────────────────────────┐
│ ⚠️  扩展需要重新加载              │
│                                  │
│ 检测到扩展上下文已失效。          │
│ 请按以下步骤操作：                │
│ 1. 打开 chrome://extensions/     │
│ 2. 找到"Web功能自动化测试工具"    │
│ 3. 点击"重新加载"按钮             │
│ 4. 刷新此页面                     │
│                                  │
│ [我知道了]                  ×   │
└──────────────────────────────────┘
```

如果您看到这个提示，请按照上面的步骤操作。

---

## 🔧 如果重新加载后还是不行

### 方案 A: 完全重装

```
1. chrome://extensions/
2. 找到扩展 → 点击"移除"
3. Chrome设置 → 清除浏览数据 → 缓存
4. 重新加载扩展：
   - 点击"加载已解压的扩展程序"
   - 选择：D:\test-auto\web-test-automation
```

### 方案 B: 检查扩展是否正确加载

```
1. chrome://extensions/
2. 确认扩展显示"已启用"（绿色）
3. 查看版本号：v2.0.0
4. 点击"详细信息"查看是否有错误
```

### 方案 C: 检查 Console 错误

```
1. F12 打开开发者工具
2. 切换到Console标签
3. 查看是否有红色错误
4. 截图发送给我分析
```

---

## 📝 预防措施

### 每次修改代码后

```
1. 保存文件
2. chrome://extensions/ → 重新加载
3. 关闭所有测试标签页
4. 重新打开测试页面
5. F12检查Console日志
```

### 日常使用时

- ✅ 遇到问题首先尝试重新加载扩展
- ✅ 注意 Console 中的错误提示
- ✅ 定期检查扩展状态

---

## ✅ 总结

**当前问题**: 扩展 context 已失效
**解决方案**: 重新加载扩展 + 重新打开页面
**验证方法**: 查看 Console 初始化日志

**请立即执行上述步骤，不要在当前失效状态下继续操作！**

---

**操作顺序**：
1️⃣ 打开 `chrome://extensions/`
2️⃣ 重新加载扩展
3️⃣ 关闭此页面
4️⃣ 重新打开页面
5️⃣ F12 查看 Console
6️⃣ 重新测试

**完成后应该就能正常工作了！** 🎉
