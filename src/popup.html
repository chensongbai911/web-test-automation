<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web测试自动化工具</title>
    <link rel="stylesheet" href="popup.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Web功能自动化测试</h1>
        <p class="subtitle">输入网址并自动化测试所有功能</p>
        <button
          id="settingsBtn"
          style="
            position: absolute;
            top: 15px;
            right: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 12px;
          "
        >
          ⚙️ Qwen设置
        </button>
      </div>

      <div class="content">
        <div class="input-section">
          <label for="urlInput">目标网址：</label>
          <input
            type="url"
            id="urlInput"
            placeholder="https://example.com"
            value=""
          />
        </div>

        <div class="config-section">
          <h3>测试配置</h3>
          <div class="config-grid">
            <label>
              <input type="checkbox" id="testInteraction" checked />
              测试交互按钮
            </label>
            <label>
              <input type="checkbox" id="monitorAPI" checked />
              监控API请求
            </label>
            <label>
              <input type="checkbox" id="captureScreenshot" checked />
              捕获截图
            </label>
            <label>
              <input type="checkbox" id="captureConsole" checked />
              捕获控制台日志
            </label>
            <label>
              <input type="checkbox" id="testForms" checked />
              测试表单输入
            </label>
            <label>
              <input type="checkbox" id="testLinks" checked />
              测试链接跳转
            </label>
          </div>
        </div>

        <div class="advanced-section">
          <h3>高级设置</h3>
          <div class="setting-item">
            <label for="delayInput">测试间隔（毫秒）：</label>
            <input
              type="number"
              id="delayInput"
              value="1200"
              min="100"
              max="5000"
              step="100"
            />
          </div>
          <div class="setting-item">
            <label for="maxElements">最大测试元素数：</label>
            <input
              type="number"
              id="maxElements"
              value="100"
              min="10"
              max="500"
              step="10"
            />
          </div>
          <div class="setting-item">
            <label for="timeoutInput">页面超时（秒）：</label>
            <input
              type="number"
              id="timeoutInput"
              value="30"
              min="5"
              max="120"
              step="5"
            />
          </div>
        </div>

        <div class="action-section">
          <button id="startTestBtn" class="btn btn-primary">
            <span class="icon">▶</span> 开始测试
          </button>
          <button id="stopTestBtn" class="btn btn-secondary" disabled>
            <span class="icon">⏹</span> 停止测试
          </button>
          <button id="viewReportBtn" class="btn btn-info" disabled>
            <span class="icon">📊</span> 查看报告
          </button>
        </div>

        <!-- Qwen设置模态窗口 -->
        <div
          id="qwenModal"
          style="
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
          "
        >
          <div
            style="
              background: white;
              border-radius: 10px;
              padding: 30px;
              width: 90%;
              max-width: 500px;
              box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            "
          >
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
              "
            >
              <h2 style="margin: 0; color: #333">🤖 Qwen API 配置</h2>
              <button
                id="closeQwenModal"
                style="
                  background: none;
                  border: none;
                  font-size: 24px;
                  cursor: pointer;
                  color: #999;
                "
              >
                ×
              </button>
            </div>

            <div style="margin-bottom: 20px">
              <label
                style="
                  display: block;
                  margin-bottom: 8px;
                  color: #666;
                  font-weight: bold;
                "
                >API 密钥：</label
              >
              <input
                type="password"
                id="qwenApiKeyInput"
                placeholder="输入您的 Qwen API 密钥"
                style="
                  width: 100%;
                  padding: 10px;
                  border: 1px solid #ddd;
                  border-radius: 5px;
                  font-size: 14px;
                  box-sizing: border-box;
                "
              />
              <small style="color: #999; display: block; margin-top: 5px">
                从
                <a
                  href="https://dashscope.aliyuncs.com/api-overview"
                  target="_blank"
                  style="color: #667eea; text-decoration: none"
                  >DashScope</a
                >
                获取您的密钥
              </small>
            </div>

            <div style="margin-bottom: 20px">
              <label style="display: flex; align-items: center; color: #666">
                <input
                  type="checkbox"
                  id="qwenEnabled"
                  checked
                  style="margin-right: 8px"
                />
                启用 Qwen AI 分析
              </label>
              <small style="color: #999; display: block; margin-top: 5px">
                启用后将使用 AI 自动分析测试报告并提供优化建议
              </small>
            </div>

            <div
              style="
                background: #f0f4ff;
                border-left: 4px solid #667eea;
                padding: 12px;
                margin-bottom: 20px;
                border-radius: 4px;
              "
            >
              <strong style="color: #667eea">💡 提示：</strong>
              <div style="color: #555; font-size: 12px; margin-top: 5px">
                • 密钥保存在本地浏览器存储中<br />
                • 密钥不会被上传到任何服务器<br />
                • 重新加载扩展后配置仍然保留<br />
                • 配置立即生效，无需重启
              </div>
            </div>

            <div style="display: flex; gap: 10px; justify-content: flex-end">
              <button
                id="testQwenBtn"
                style="
                  background: #f5f5f5;
                  color: #333;
                  border: 1px solid #ddd;
                  padding: 10px 20px;
                  border-radius: 5px;
                  cursor: pointer;
                "
              >
                🔍 测试连接
              </button>
              <button
                id="saveQwenBtn"
                style="
                  background: #667eea;
                  color: white;
                  border: none;
                  padding: 10px 20px;
                  border-radius: 5px;
                  cursor: pointer;
                "
              >
                💾 保存配置
              </button>
            </div>

            <div
              id="qwenTestResult"
              style="
                margin-top: 15px;
                padding: 10px;
                border-radius: 5px;
                display: none;
                font-size: 12px;
              "
            ></div>
          </div>
        </div>

        <div class="status-section" id="statusSection" style="display: none">
          <h3>测试状态</h3>
          <div class="status-bar">
            <div class="progress-bar" id="progressBar"></div>
          </div>
          <div class="status-info">
            <p>已测试按钮: <span id="testedCount">0</span></p>
            <p>成功: <span id="successCount">0</span></p>
            <p>失败: <span id="failureCount">0</span></p>
            <p>API错误: <span id="apiErrorCount">0</span></p>
          </div>
          <div class="log-area">
            <div id="logContainer" class="log-container"></div>
          </div>
        </div>
      </div>
    </div>

    <script src="qwen-integration.js"></script>
    <script src="popup.js"></script>
  </body>
</html>
