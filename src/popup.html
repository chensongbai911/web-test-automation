<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Webæµ‹è¯•è‡ªåŠ¨åŒ–å·¥å…·</title>
    <link rel="stylesheet" href="popup.css" />
    <style>
      /* æ ‡ç­¾é¡µæ ·å¼ */
      .tabs {
        display: flex;
        gap: 0;
        border-bottom: 2px solid #e0e0e0;
        margin-bottom: 20px;
      }

      .tab-btn {
        flex: 1;
        padding: 12px;
        background: none;
        border: none;
        border-bottom: 3px solid transparent;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        color: #666;
        transition: all 0.3s;
      }

      .tab-btn:hover {
        color: #333;
        background: #f9f9f9;
      }

      .tab-btn.active {
        color: #667eea;
        border-bottom-color: #667eea;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      /* ä¸Šä¼ åŒºåŸŸæ ·å¼ */
      .upload-section {
        margin-bottom: 20px;
      }

      .upload-box {
        border: 2px dashed #667eea;
        border-radius: 8px;
        padding: 30px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        background: #f9faff;
      }

      .upload-box:hover {
        border-color: #5568d3;
        background: #f5f7ff;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
      }

      .upload-box.dragover {
        border-color: #5568d3;
        background: #f0f4ff;
      }

      .upload-icon {
        font-size: 32px;
        margin-bottom: 8px;
      }

      .upload-title {
        font-size: 14px;
        font-weight: 600;
        color: #333;
        margin-bottom: 4px;
      }

      .upload-subtitle {
        font-size: 12px;
        color: #999;
      }

      /* æ–‡ä»¶ä¿¡æ¯æ ·å¼ */
      .file-info {
        padding: 15px;
        background: #f0f9ff;
        border-radius: 8px;
        border-left: 4px solid #0066cc;
      }

      .file-name {
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
        word-break: break-all;
      }

      .file-stats {
        font-size: 12px;
        color: #666;
        line-height: 1.6;
      }

      .file-errors {
        margin-top: 10px;
        padding: 10px;
        background: #fff3cd;
        border-radius: 4px;
        border-left: 3px solid #ff6b6b;
      }

      .file-errors.error {
        background: #f8d7da;
        border-left-color: #dc3545;
      }

      .file-errors ul {
        margin: 0;
        padding-left: 20px;
        font-size: 12px;
        color: #333;
      }

      .file-errors li {
        margin: 4px 0;
      }

      .file-errors strong {
        color: #dc3545;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>WebåŠŸèƒ½è‡ªåŠ¨åŒ–æµ‹è¯•</h1>
        <p class="subtitle">æ™ºèƒ½åŒ–è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°</p>
        <button
          id="settingsBtn"
          style="
            position: absolute;
            top: 15px;
            right: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 12px;
          "
        >
          âš™ï¸ Qwenè®¾ç½®
        </button>
      </div>

      <div class="content">
        <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
        <div class="tabs">
          <button class="tab-btn active" data-tab="manual">ğŸ” è‡ªåŠ¨åˆ†æ</button>
          <button class="tab-btn" data-tab="custom">ğŸ“‹ è‡ªå®šä¹‰æµ‹è¯•</button>
        </div>

        <!-- æ ‡ç­¾é¡µ 1: è‡ªåŠ¨åˆ†æ -->
        <div id="manual-tab" class="tab-content active">
          <div class="input-section">
            <label for="urlInput">ç›®æ ‡ç½‘å€ï¼š</label>
            <input
              type="url"
              id="urlInput"
              placeholder="https://example.com"
              value=""
            />
          </div>

          <div class="input-section" style="margin-top: 10px">
            <label for="testIntentInput">æ™ºèƒ½æµ‹è¯•æ„å›¾ï¼ˆå¯é€‰ï¼‰ï¼š</label>
            <textarea
              id="testIntentInput"
              rows="2"
              placeholder="ä¾‹å¦‚ï¼šæµ‹è¯•ç”µå•†ç½‘ç«™çš„å®Œæ•´è´­ç‰©æµç¨‹"
            ></textarea>
            <small style="color: #777"
              >å¡«å†™åå¯ä½¿ç”¨AIç†è§£æ„å›¾ç”Ÿæˆæµ‹è¯•è®¡åˆ’å¹¶æ¨èé…ç½®</small
            >
          </div>

          <div class="config-section">
            <h3>æµ‹è¯•é…ç½®</h3>
            <div class="config-grid">
              <label>
                <input type="checkbox" id="testInteraction" checked />
                æµ‹è¯•äº¤äº’æŒ‰é’®
              </label>
              <label>
                <input type="checkbox" id="monitorAPI" checked />
                ç›‘æ§APIè¯·æ±‚
              </label>
              <label>
                <input type="checkbox" id="captureScreenshot" checked />
                æ•è·æˆªå›¾
              </label>
              <label>
                <input type="checkbox" id="captureConsole" checked />
                æ•è·æ§åˆ¶å°æ—¥å¿—
              </label>
              <label>
                <input type="checkbox" id="testForms" checked />
                æµ‹è¯•è¡¨å•è¾“å…¥
              </label>
              <label>
                <input type="checkbox" id="testLinks" checked />
                æµ‹è¯•é“¾æ¥è·³è½¬
              </label>
            </div>
          </div>

          <div class="advanced-section">
            <h3>é«˜çº§è®¾ç½®</h3>
            <div class="setting-item">
              <label for="delayInput">æµ‹è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼š</label>
              <input
                type="number"
                id="delayInput"
                value="1200"
                min="100"
                max="5000"
                step="100"
              />
            </div>
            <div class="setting-item">
              <label for="maxElements">æœ€å¤§æµ‹è¯•å…ƒç´ æ•°ï¼š</label>
              <input
                type="number"
                id="maxElements"
                value="100"
                min="10"
                max="500"
                step="10"
              />
            </div>
            <div class="setting-item">
              <label for="timeoutInput">é¡µé¢è¶…æ—¶ï¼ˆç§’ï¼‰ï¼š</label>
              <input
                type="number"
                id="timeoutInput"
                value="30"
                min="5"
                max="120"
                step="5"
              />
            </div>
          </div>
        </div>

        <!-- æ ‡ç­¾é¡µ 2: è‡ªå®šä¹‰æµ‹è¯• -->
        <div id="custom-tab" class="tab-content">
          <div class="upload-section">
            <div class="upload-box" id="uploadBox">
              <div class="upload-icon">ğŸ“„</div>
              <div class="upload-title">ä¸Šä¼ æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£</div>
              <div class="upload-subtitle">æ‹–æ”¾ JSON æ–‡ä»¶æˆ–ç‚¹å‡»é€‰æ‹©</div>
              <input
                type="file"
                id="testCaseFile"
                accept=".json"
                style="display: none"
              />
            </div>

            <div class="file-info" id="fileInfo" style="display: none">
              <div class="file-name" id="fileName"></div>
              <div class="file-stats" id="fileStats"></div>
              <div
                class="file-errors"
                id="fileErrors"
                style="display: none"
              ></div>
              <button
                id="clearFileBtn"
                class="btn btn-secondary"
                style="margin-top: 10px"
              >
                âœ• æ¸…é™¤æ–‡ä»¶
              </button>
            </div>
          </div>

          <div
            style="
              margin-top: 15px;
              padding: 12px;
              background: #f0f9ff;
              border-radius: 5px;
              font-size: 12px;
            "
          >
            <strong style="color: #0066cc">ğŸ“– å¦‚ä½•ä½¿ç”¨ï¼š</strong>
            <ol style="margin: 8px 0; padding-left: 20px; color: #333">
              <li>
                ä¸‹è½½
                <a
                  href="#"
                  id="downloadTemplateBtn"
                  style="color: #0066cc; text-decoration: underline"
                  >æµ‹è¯•æ¨¡æ¿</a
                >
              </li>
              <li>æŒ‰ç…§æ ¼å¼ç¼–å†™ä½ çš„æµ‹è¯•ç”¨ä¾‹</li>
              <li>ä¸Šä¼  JSON æ–‡ä»¶</li>
              <li>ç‚¹å‡»"å¼€å§‹æµ‹è¯•"æ‰§è¡Œ</li>
            </ol>
          </div>
        </div>

        <!-- å…±äº«çš„æ“ä½œæŒ‰é’® -->
        <div class="action-section">
          <button id="startTestBtn" class="btn btn-primary">
            <span class="icon">â–¶</span> å¼€å§‹æµ‹è¯•
          </button>
          <button
            id="startIntelligentTestBtn"
            class="btn btn-primary"
            style="margin-left: 8px"
          >
            <span class="icon">ğŸ¤–</span> å¼€å§‹æ™ºèƒ½æµ‹è¯•
          </button>
          <button id="stopTestBtn" class="btn btn-secondary" disabled>
            <span class="icon">â¹</span> åœæ­¢æµ‹è¯•
          </button>
          <button id="viewReportBtn" class="btn btn-info" disabled>
            <span class="icon">ğŸ“Š</span> æŸ¥çœ‹æŠ¥å‘Š
          </button>
        </div>

        <!-- æµ‹è¯•çŠ¶æ€åŒºåŸŸ -->
        <div class="status-section" id="statusSection" style="display: none">
          <h3>æµ‹è¯•çŠ¶æ€</h3>
          <div class="status-bar">
            <div class="progress-bar" id="progressBar"></div>
          </div>
          <div class="status-info">
            <p>å·²æµ‹è¯•é¡¹ç›®: <span id="testedCount">0</span></p>
            <p>æˆåŠŸ: <span id="successCount">0</span></p>
            <p>å¤±è´¥: <span id="failureCount">0</span></p>
            <p>éªŒè¯å¤±è´¥: <span id="apiErrorCount">0</span></p>
          </div>
          <div class="log-area">
            <div id="logContainer" class="log-container"></div>
            <div
              id="aiPlanContainer"
              class="log-container"
              style="margin-top: 8px; display: none"
            ></div>
          </div>
        </div>

        <!-- Qwenè®¾ç½®æ¨¡æ€çª—å£ -->
        <div
          id="qwenModal"
          style="
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
          "
        >
          <div
            style="
              background: white;
              border-radius: 10px;
              padding: 30px;
              width: 90%;
              max-width: 500px;
              box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            "
          >
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
              "
            >
              <h2 style="margin: 0; color: #333">ğŸ¤– Qwen API é…ç½®</h2>
              <button
                id="closeQwenModal"
                style="
                  background: none;
                  border: none;
                  font-size: 24px;
                  cursor: pointer;
                  color: #999;
                "
              >
                Ã—
              </button>
            </div>

            <div style="margin-bottom: 20px">
              <label
                style="
                  display: block;
                  margin-bottom: 8px;
                  color: #666;
                  font-weight: bold;
                "
                >API å¯†é’¥ï¼š</label
              >
              <input
                type="password"
                id="qwenApiKeyInput"
                placeholder="è¾“å…¥æ‚¨çš„ Qwen API å¯†é’¥"
                style="
                  width: 100%;
                  padding: 10px;
                  border: 1px solid #ddd;
                  border-radius: 5px;
                  font-size: 14px;
                  box-sizing: border-box;
                "
              />
              <small style="color: #999; display: block; margin-top: 5px">
                ä»
                <a
                  href="https://dashscope.aliyuncs.com/api-overview"
                  target="_blank"
                  style="color: #667eea; text-decoration: none"
                  >DashScope</a
                >
                è·å–æ‚¨çš„å¯†é’¥
              </small>
            </div>

            <div style="margin-bottom: 20px">
              <label style="display: flex; align-items: center; color: #666">
                <input
                  type="checkbox"
                  id="qwenEnabled"
                  checked
                  style="margin-right: 8px"
                />
                å¯ç”¨ Qwen AI åˆ†æ
              </label>
              <small style="color: #999; display: block; margin-top: 5px">
                å¯ç”¨åå°†ä½¿ç”¨ AI è‡ªåŠ¨åˆ†ææµ‹è¯•æŠ¥å‘Šå¹¶æä¾›ä¼˜åŒ–å»ºè®®
              </small>
            </div>

            <div
              style="
                background: #f0f4ff;
                border-left: 4px solid #667eea;
                padding: 12px;
                margin-bottom: 20px;
                border-radius: 4px;
              "
            >
              <strong style="color: #667eea">ğŸ’¡ æç¤ºï¼š</strong>
              <div style="color: #555; font-size: 12px; margin-top: 5px">
                â€¢ å¯†é’¥ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨å­˜å‚¨ä¸­<br />
                â€¢ å¯†é’¥ä¸ä¼šè¢«ä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨<br />
                â€¢ é‡æ–°åŠ è½½æ‰©å±•åé…ç½®ä»ç„¶ä¿ç•™<br />
                â€¢ é…ç½®ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯
              </div>
            </div>

            <div style="display: flex; gap: 10px; justify-content: flex-end">
              <button
                id="testQwenBtn"
                style="
                  background: #f5f5f5;
                  color: #333;
                  border: 1px solid #ddd;
                  padding: 10px 20px;
                  border-radius: 5px;
                  cursor: pointer;
                "
              >
                ğŸ” æµ‹è¯•è¿æ¥
              </button>
              <button
                id="saveQwenBtn"
                style="
                  background: #667eea;
                  color: white;
                  border: none;
                  padding: 10px 20px;
                  border-radius: 5px;
                  cursor: pointer;
                "
              >
                ğŸ’¾ ä¿å­˜é…ç½®
              </button>
            </div>

            <div
              id="qwenTestResult"
              style="
                margin-top: 15px;
                padding: 10px;
                border-radius: 5px;
                display: none;
                font-size: 12px;
              "
            ></div>
          </div>
        </div>
      </div>
    </div>

    <script src="test-case-parser.js"></script>
    <script src="qwen-integration.js"></script>
    <script src="popup.js"></script>
  </body>
</html>
