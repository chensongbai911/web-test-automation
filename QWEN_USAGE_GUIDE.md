# Web 功能自动化测试工具 - Qwen 集成使用指南

## 🤖 通义千问(Qwen3-max)集成

本工具已集成阿里云通义千问(Qwen3-max)大模型，提供强大的 AI 智能化能力。

### 📋 功能特性

#### 1️⃣ **智能页面分析**

- 自动理解页面结构和业务逻辑
- 识别表单字段和交互元素
- 检测页面中的风险点

#### 2️⃣ **智能数据生成**

- 根据字段类型和上下文生成合适的测试数据
- 生成真实可信的测试数据
- 支持各种字段类型（邮箱、电话、日期等）

#### 3️⃣ **自适应错误恢复**

- 智能诊断测试中的错误
- 提供自动化的恢复措施
- 大幅提高测试成功率

#### 4️⃣ **动态选择器生成**

- 为页面元素生成多个备用选择器
- 提高元素定位的鲁棒性
- 自动应对页面改版

#### 5️⃣ **自然语言支持**

- 使用自然语言描述测试流程
- AI 自动转换为测试脚本
- 降低使用门槛

#### 6️⃣ **智能报告生成**

- 分析测试结果并生成建议
- 评估测试覆盖率和风险
- 提供可视化报告

#### 7️⃣ **业务流程理解**

- 理解复杂的业务逻辑
- 自动生成完整的测试用例
- 识别隐藏的业务风险

---

## 🚀 快速开始

### 第一步：获取 Qwen API 密钥

1. 访问 [阿里云 DashScope 控制台](https://dashscope.aliyun.com/)
2. 注册或登录阿里云账户
3. 创建新的 API 密钥
4. 复制密钥（格式：`sk-xxxxxxx`）

> **注意**：首次使用会有免费额度，完全可以用于测试和开发。

### 第二步：配置 Qwen API

1. 在扩展程序 popup 中点击 **⚙️ Qwen 设置** 按钮
2. 在弹出的设置页面输入 API 密钥
3. 点击 **🧪 测试连接** 验证密钥有效性
4. 点击 **💾 保存设置** 保存配置
5. 看到 ✓ 绿色提示表示配置成功

### 第三步：使用 Qwen 功能

配置完成后，以下功能会自动启用：

- ✅ 页面分析时会获得 AI 的智能建议
- ✅ 表单填充会使用更聪明的数据
- ✅ 测试失败时会得到智能恢复方案
- ✅ 测试完成后会得到 AI 的分析报告

---

## 💡 使用示例

### 示例 1：测试登录表单

```
1. 打开需要测试的登录页面
2. 在插件中点击"开始测试"
3. AI会自动：
   - 分析登录表单结构
   - 生成合适的测试数据
   - 自动填充用户名和密码
   - 点击登录按钮
   - 如果出错，自动诊断和恢复
   - 生成详细的测试报告
```

### 示例 2：测试电商购物流程

```
1. 输入电商网站URL
2. 点击"开始测试"
3. AI会自动：
   - 理解购物流程（浏览→加购→结算）
   - 为每个步骤生成真实的测试数据
   - 处理各种弹框和提示
   - 验证每个步骤的结果
   - 生成完整的端到端测试报告
```

---

## 📊 成本分析

### 费用计算

| 操作类型 | 频率      | Token 消耗 | 费用     |
| -------- | --------- | ---------- | -------- |
| 页面分析 | 1 次/页   | 2000       | ¥0.0006  |
| 数据生成 | 1 次/字段 | 500        | ¥0.00015 |
| 错误诊断 | 仅失败    | 1500       | ¥0.00045 |
| 报告生成 | 1 次/测试 | 3000       | ¥0.0009  |

**总计**：约 **¥1.5 元/100 个测试** ✅

### 免费额度

- 新用户通常有 100 万 tokens 的免费额度
- 可以进行约 **500 次完整测试**
- 完全足够开发和测试使用

---

## ⚙️ 配置管理

### API 密钥安全

✅ **安全特性**：

- API 密钥仅保存在浏览器本地存储
- 不会上传到任何第三方服务器
- 不会以明文形式显示（可以隐藏/显示）
- 支持随时修改或删除

### 禁用 Qwen 功能

如果不想使用 Qwen 功能，有三种方式：

**方式 1**：不配置 API 密钥

- 工具会以降级模式运行
- 所有 Qwen 相关功能自动禁用

**方式 2**：删除已保存的密钥

- 打开设置页面
- 清空 API 密钥输入框
- 点击保存

**方式 3**：在扩展程序中禁用本插件

- 打开 Chrome 扩展程序管理页
- 找到"Web 功能自动化测试工具"
- 点击禁用

---

## 🔧 高级配置

### API 调用限制

如果需要限制 API 调用频率，可以修改 `qwen-integration.js` 中的参数：

```javascript
this.rateLimitDelay = 100; // 请求间隔（毫秒）
```

### 模型选择

当前使用的模型是 `qwen-max`（通义千问最强模型）

如果需要切换到其他模型：

```javascript
this.model = "qwen-max"; // 可改为 'qwen-plus'、'qwen-turbo' 等
```

不同模型的对比：

| 模型       | 能力 | 速度 | 费用   |
| ---------- | ---- | ---- | ------ |
| qwen-max   | 最强 | 中等 | 标准   |
| qwen-plus  | 中等 | 快速 | 便宜   |
| qwen-turbo | 基础 | 很快 | 最便宜 |

---

## 🐛 故障排查

### 问题 1：API 连接失败

**症状**：出现 "❌ 连接错误" 消息

**原因和解决**：

1. ❌ API 密钥格式不正确 → 重新复制正确的密钥
2. ❌ 网络连接问题 → 检查网络
3. ❌ API 额度用完 → 升级账户或等待下月重置

### 问题 2：测试速度变慢

**症状**：启用 Qwen 后测试变慢

**原因和解决**：

- Qwen API 调用需要网络延迟（通常 1-3 秒）
- 可以接受的权衡（换来更高的成功率）
- 如果不能接受，可以禁用 Qwen 功能

### 问题 3：某些功能不工作

**症状**：虽然配置了 Qwen，但功能不起作用

**原因和解决**：

- 检查 API 密钥是否正确保存
- 在设置页面点击"测试连接"验证
- 查看浏览器控制台看是否有错误信息
- 清除浏览器缓存后重新加载

---

## 📖 API 文档

### 核心方法

```javascript
// 获取Qwen实例
const qwen = getQwenInstance(apiKey);

// 智能页面分析
await qwen.analyzePage(pageHTML, pageInfo);

// 智能数据生成
await qwen.generateTestData(fieldInfo, context);

// 错误诊断和恢复
await qwen.diagnoseAndRecover(errorInfo);

// 动态选择器生成
await qwen.generateRobustSelectors(element, pageContext);

// 自然语言转脚本
await qwen.generateTestScript(instruction);

// 报告分析
await qwen.analyzeTestResults(testData);

// 业务逻辑理解
await qwen.understandBusinessLogic(flowDescription, pageContext);

// 通用聊天
await qwen.chat(message, conversationHistory);
```

---

## 📞 技术支持

如有问题或建议：

1. 检查浏览器控制台日志
2. 查看本指南的故障排查部分
3. 联系阿里云 DashScope 支持团队
4. 提交 Issue 到项目仓库

---

## 📝 更新日志

### v1.5.0

- ✨ 集成通义千问(Qwen3-max)
- ✨ 增加智能页面分析
- ✨ 增加智能数据生成
- ✨ 增加自适应错误恢复
- ✨ 增加智能报告生成

---

## 📄 许可证

MIT License

---

**Happy Testing! 🎉**
